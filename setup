#!/bin/bash

set -euo pipefail

# Install fish shell if not present, then set as default
if ! command -v fish >/dev/null; then
  if command -v apt-get >/dev/null; then
    sudo apt-get update -y
    sudo apt-get install -y fish
  elif command -v dnf >/dev/null; then
    sudo dnf install -y fish
  elif command -v pacman >/dev/null; then
    sudo pacman -Sy --noconfirm fish
  else
    echo "Package manager not recognized; install fish manually" >&2
  fi
fi
if command -v fish >/dev/null; then
  sudo chsh -s "$(command -v fish)" "$USER"
fi

# (Legacy) Setting Up zsh if desired and available but not default request
# Keeping original logic commented for reference
# if command -v zsh >/dev/null; then
#   sudo chsh -s $(command -v zsh) $USER
# fi

# Bootstrap chezmoi if missing
if ! command -v chezmoi >/dev/null; then
  sh -c "$(curl -fsLS get.chezmoi.io)" -- init --apply git@github.com:fcosanabria/dotfiles-refactor.git
fi

exit 0
